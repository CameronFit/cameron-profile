/* Angular Material v17/18 â€“ M3 theme setup */
@use '@angular/material' as mat;

@include mat.core();

$cameron-profile-theme: mat.define-theme((
  color: (
    theme-type: dark,
    primary: mat.$azure-palette,
    tertiary: mat.$blue-palette,
  ),
  density: (
    scale: 0
  ),
  typography: (
    brand-family: 'Inter, Roboto, "Helvetica Neue", Arial, sans-serif',
    bold-weight: 600
  )
));

/* Apply theme to the whole document per M3 guidance */
:root {
  @include mat.all-component-themes($cameron-profile-theme);

  /* Optional: apply system-level typography to native elements */
  @include mat.system-level-typography($cameron-profile-theme);

  /* Bridge Material CSS variables to our design tokens so theme toggle updates components */
  /* Toolbar */
  --mat-toolbar-container-background-color: var(--topbar-bg);
  --mat-toolbar-container-text-color: var(--text);

  /* Form fields (MDC filled and outlined) */
  --mdc-filled-text-field-container-color: var(--surface-2);
  --mdc-filled-text-field-label-text-color: var(--text-dim);
  --mdc-filled-text-field-input-text-color: var(--text);
  --mdc-filled-text-field-caret-color: var(--accent);
  --mdc-filled-text-field-active-indicator-color: var(--border);
  --mdc-filled-text-field-hover-active-indicator-color: var(--border);
  --mdc-filled-text-field-focus-active-indicator-color: var(--accent);
  --mdc-filled-text-field-disabled-container-color: var(--surface-3);
  --mdc-filled-text-field-disabled-container-opacity: 1;

  --mdc-outlined-text-field-label-text-color: var(--text-dim);
  --mdc-outlined-text-field-input-text-color: var(--text);
  --mdc-outlined-text-field-caret-color: var(--accent);
  --mdc-outlined-text-field-outline-color: var(--border);
  --mdc-outlined-text-field-hover-outline-color: var(--border);
  --mdc-outlined-text-field-focus-outline-color: var(--accent);

  /* Generic text & icon colors */
  --mat-option-label-text-color: var(--text);
  --mat-select-enabled-trigger-text-color: var(--text);
  --mat-form-field-container-text-color: var(--text);
  --mat-form-field-container-underline-color: var(--border);
  --mat-form-field-container-text-start: var(--text);

  /* Select panel & options */
  --mat-select-panel-background-color: var(--surface-2);
  --mat-select-panel-foreground-color: var(--text);
  --mat-select-enabled-arrow-color: var(--text-dim);
  --mat-select-focused-arrow-color: var(--accent);
  --mat-select-panel-border-color: var(--border);
  --mat-select-panel-placeholder-color: var(--text-dim);
  --mat-select-option-selected-state-label-text-color: var(--accent);
  --mat-select-option-label-text-color: var(--text);
  --mat-select-option-hover-state-layer-color: var(--hover-bg);
  --mat-select-option-focus-state-layer-color: var(--hover-bg-strong);
}

/* Light theme overrides where necessary (ensure select panel stays light) */
:root[data-theme="light"] {
  --mat-select-panel-background-color: var(--surface-2);
  --mat-select-panel-foreground-color: var(--text);
  --mat-select-enabled-arrow-color: var(--text-dim);
  --mat-select-focused-arrow-color: var(--accent);
  --mat-select-option-selected-state-label-text-color: var(--accent);
  --mat-select-option-label-text-color: var(--text);
  
  /* Form field fixes for light theme */
  --mdc-filled-text-field-container-color: var(--surface-3);
  --mdc-filled-text-field-hover-state-layer-color: rgba(0, 0, 0, 0.04);
  --mdc-filled-text-field-hover-active-indicator-color: var(--text);
  
  --mdc-outlined-text-field-hover-outline-color: var(--text);
  --mdc-outlined-text-field-hover-label-text-color: var(--text);
  
  /* Button fixes for light theme - ensure primary buttons are visible */
  --mdc-filled-button-container-color: var(--primary);
  --mdc-filled-button-label-text-color: #ffffff;
  --mdc-protected-button-container-color: var(--primary);
  --mdc-protected-button-label-text-color: #ffffff;
  
  /* Raised button (mat-raised-button) with color="primary" */
  --mat-protected-button-state-layer-color: var(--primary);
  --mat-protected-button-ripple-color: rgba(255, 255, 255, 0.1);
  --mat-protected-button-container-color: var(--primary);
  --mat-protected-button-label-text-color: #ffffff;
  --mat-protected-button-disabled-container-color: rgba(0, 0, 0, 0.12);
  --mat-protected-button-disabled-label-text-color: rgba(0, 0, 0, 0.38);
  
  /* Additional Material button token overrides */
  --mat-fab-foreground-color: #ffffff;
  --mat-fab-state-layer-color: #ffffff;
  
  /* Ensure icons in buttons are white */
  --mat-icon-color: inherit;
}

/* Light theme button explicit styles to override Material theming */
:root[data-theme="light"] {
  .mat-mdc-raised-button.mat-primary {
    --mdc-protected-button-container-color: var(--primary) !important;
    --mdc-protected-button-label-text-color: #ffffff !important;
    background-color: var(--primary) !important;
    color: #ffffff !important;
    
    /* Fix alignment and display */
    .mat-mdc-button-touch-target {
      background-color: var(--primary) !important;
    }
    
    .mdc-button__label {
      color: #ffffff !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 8px !important;
    }
    
    .mat-icon {
      color: #ffffff !important;
      display: inline-flex !important;
    }
    
    span {
      color: #ffffff !important;
      display: inline-block !important;
    }
    
    &:hover:not([disabled]) {
      --mdc-protected-button-container-color: var(--primary) !important;
      background-color: var(--primary) !important;
      
      .mat-icon {
        color: #ffffff !important;
      }
      
      span {
        color: #ffffff !important;
      }
    }
    
    &[disabled] {
      background-color: rgba(0, 0, 0, 0.12) !important;
      color: rgba(0, 0, 0, 0.38) !important;
      
      .mat-icon {
        color: rgba(0, 0, 0, 0.38) !important;
      }
      
      span {
        color: rgba(0, 0, 0, 0.38) !important;
      }
    }
  }
}

/* Optional: high-contrast focus ring for keyboard nav */
.cdk-focused .mat-mdc-select-panel, .mat-mdc-select-panel:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}
